# 更新日志 (Changelog)

## [最新版本] - 2026-01-23

### 🎉 重大更新

本次更新对项目进行了全面重构和优化，整合了两个优秀的刷课程序，打造了一个更强大、更稳定的微伴助手。

### ✨ 新增功能

#### 1. **考试重考系统** 🎯
- ✅ 实现了完整的考试重考功能
- ✅ 支持 GUI 界面交互式重考确认
- ✅ 自动检测考试分数，低于阈值时提示重考
- ✅ 支持自定义错题阈值控制
- ✅ 智能重考逻辑，避免无限重考

#### 2. **优化的答题显示** 📊
- ✅ 完全采用简洁清晰的答题显示风格
- ✅ 每道题目显示题目内容和答案信息
- ✅ 清晰的题库匹配状态提示
- ✅ 详细的 AI 答题过程展示
- ✅ 匹配度统计和考试完成信息

#### 3. **本地题库优先策略** 📚
- ✅ 优先使用本地 `QuestionBank/result.json` 题库
- ✅ 智能模糊匹配算法，提高题库利用率
- ✅ 考试结束后自动同步正确答案到本地题库
- ✅ 不再依赖远程题库下载
- ✅ 支持手动更新题库

### 🔧 功能优化

#### 1. **代码架构优化**
- ✅ 整合 `WeBan-3.5.20/client.py` 和 `WBCore.py` 的核心功能
- ✅ 采用 `WeBanClient` 类作为核心业务逻辑
- ✅ 实现 `WeibanHelper` 兼容层，保持 API 一致性
- ✅ 优化代码结构，提高可维护性

#### 2. **UI 显示优化**
- ✅ 简化日志输出，去除冗余信息
- ✅ 采用树状结构显示学习进度
- ✅ 优化答题过程的实时反馈
- ✅ 改进匹配度显示格式
- ✅ 统一显示风格，提升用户体验

#### 3. **题库管理优化**
- ✅ 移除对 `answer/answer.json` 的依赖
- ✅ 统一使用 `QuestionBank/result.json` 作为题库
- ✅ 优化题库加载和匹配逻辑
- ✅ 改进答案保存机制（仅保存正确答案）

#### 4. **错误处理优化**
- ✅ 修复验证码校验 404 错误
- ✅ 改进网络请求重试机制
- ✅ 优化异常处理和错误提示
- ✅ 增强程序稳定性

### 🗑️ 清理工作

- ✅ 删除旧版文件：`main1.py`、`WBCore1.py`
- ✅ 移除旧题库目录：`answer/`
- ✅ 清理参考项目：`WeBan-3.5.20/`
- ✅ 移除规划文档：`.trae/`
- ✅ 精简项目结构，保持代码库整洁

### 📝 代码改进

#### 答题逻辑优化
- 预扫描阶段不输出详细信息，避免干扰
- 处理题目时显示完整的题目和答案信息
- 优化 AI 答题流程和错误处理
- 改进题库匹配算法，提高准确率

#### 显示格式统一
- 统一使用 `print` 输出，与参考实现保持一致
- 优化匹配度显示格式
- 改进考试完成后的信息展示
- 添加时间戳显示

### 🔍 技术细节

#### 核心类结构
```python
WeBanClient          # 核心业务逻辑类
├── run_study()      # 学习功能
├── run_exam()       # 考试功能
├── sync_answers()   # 同步答案
└── _get_answer_from_bank()  # 题库匹配

WeibanHelper         # 兼容层，供 GUI 调用
```

#### 题库匹配策略
1. 优先精确匹配题目标题
2. 模糊匹配（相似度 > 0.8）
3. 选项相似度检查（阈值 0.7）
4. AI 辅助答题（可选）
5. 随机策略（最后备选）

### ⚠️ 注意事项

1. **题库文件位置变更**
   - 旧版使用 `answer/answer.json`
   - 新版使用 `QuestionBank/result.json`
   - 请确保题库文件在正确位置

2. **配置文件**
   - AI 配置仍使用 `ai.conf`
   - 考试阈值和等待时间可在代码中配置

3. **兼容性**
   - 保持与现有 GUI 界面的完全兼容
   - API 接口保持一致
   - 配置文件格式不变

### 🐛 修复的问题

- ✅ 修复重考系统无法使用的问题
- ✅ 修复题库读取失败的问题
- ✅ 修复验证码校验 404 错误
- ✅ 修复答题显示格式不一致的问题
- ✅ 修复冗余日志输出的问题

### 📚 文档更新

- ✅ 更新项目结构说明
- ✅ 添加更新日志文档
- ✅ 完善使用说明

### 🙏 致谢

感谢所有为本项目做出贡献的开发者和用户！

---

## 升级指南

### 从旧版本升级

1. **备份数据**
   ```bash
   # 备份旧题库（如果有）
   cp answer/answer.json backup_answer.json
   ```

2. **更新代码**
   ```bash
   git pull origin main
   ```

3. **检查依赖**
   ```bash
   pip install -r requirements.txt --upgrade
   ```

4. **验证功能**
   - 检查 `QuestionBank/result.json` 是否存在
   - 测试登录功能
   - 测试答题功能

### 迁移题库数据

如果您有旧的 `answer/answer.json` 文件，可以使用 `QuestionBank/QuestionBank.py` 工具合并到新题库：

```bash
python QuestionBank/QuestionBank.py
```

---

**版本号**: v2.0.0  
**更新日期**: 2026-01-23  
**主要贡献者**: AI Assistant & Community
